<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCS020 Issue 1.3 Calculator</title>
</head>
<body>
    <h1>Sum Calculator 0934</h1>
    <p>Enter the numbers:</p>
    
    <!-- First Number Input -->
    <div>
        <label for="num1">Maximum dB of Heat Pump:</label><br>
        <input type="number" id="num1" placeholder="Enter number">
    </div>
    
    <!-- Second Number Input -->
    <div>
        <label for="num2">Reflective surfaces 1-3:</label><br>
        <input type="number" id="num2" placeholder="Enter number">
    </div>

    
    <!-- Third Number Input -->
    <div>
        <label for="num3">Distance Heat Pump to Assessment Point 1m-30m:</label><br>
        <input type="number" id="num3" placeholder="Enter number">
    </div>
    
    <!-- Fourth Number Input -->
    <div>
        <label for="num4">Barrier: None=0 Partial=5 Full=10:</label><br>
        <input type="number" id="num4" placeholder="Enter number">
    </div> 
     
    <!-- Calculate Button -->
    <div>
        <button type="button" onclick="calculateSum()">Calculate</button>
    </div>
    
    <!-- Result Display -->
    <p id="resulx"></p>
    <p id="result"></p>

    <script>
        function doStepFour(fMDist, i012) {
          let fDistReductn;
          if (bStep4ByTable === true) {
            fDistReductn = doStepOriginalFour(fMDist, i012); // As original MCS020 Table 4
          } else {
            fDistReductn = stepByEquatn4(fMDist, i012); // Use equation 
          }
          return fDistReductn;
        }
        
        function doStepOriginalFour(fMDist, i012) {
          // Note 4: DB DISTANCE REDUCTION (STEP4)
          // fMDist is in range 1 thro 30 inclusive fitting into horizontal columns in Table
          // i012 is 0, 1 or 2 reflecting Q result 2, 4 or 8 down Table
          const ixxCol = mToCol(fMDist); // Convert distance to column
          const yy = i012 * 3; // So now 0, 3 or 6
          let iTablVal = hrr[1][ixxCol] + yy; // 2nd row down with results
          if (yy > 0 && ixxCol === 5) {
            iTablVal -= 1; // anomaly
          }
          console.log(`${fMDist} ${ixxCol} ${i012} ${iTablVal}`); // For testing
          return iTablVal;
        }
        
        // For Step 4 fit using 4PL Symetrical Sigmoidal with original 5,-21 for Q2
        const K1 = -84.13366;
        const K2 = 29.64521;
        const K3 = -84.13366;
        const K4 = 9.496686;
        const K5 = 0.3130866;
        
        function cuFit(fxx) {
          return K1 + (K2 - K3) / (1 + Math.pow((fxx / K4), K5)); // As float
        }
        
        function stepByEquatn4(fMDist, i012) {
          // Note 4: DB DISTANCE REDUCTION (STEP4) but use equation not original MCS020 table
          // fMDist is in range 1 thro 30 inclusive fitting into horizontal columns in Table
          // i012 is 0, 1 or 2 reflecting Q result 2, 4 or 8
          let fDBAdistanceReduction = cuFit(fMDist); // Worked for Q2
          if (i012 === 1) {
            fDBAdistanceReduction += 3; // For Q4
          } else if (i012 === 2) {
            fDBAdistanceReduction += 6; // For Q8
          }
          return parseFloat(fDBAdistanceReduction.toFixed(4)); // For presentation curtail digits after decimal place
        }

        function testCurvFits() {
          const sFilnm = "mcs020CurvFitTest.txt";
          let sTmp = "For curve fitting original Step 4 table\n";
          // Note 4 hrr
          for (let xx = 0; xx < 14; xx++) {
            let iTablVal = hrr[0][xx]; // Distance from Heat Pump in metres. Step 3 result.
            let iyVal = hrr[1][xx]; // Q2 step result
            if (xx === 5) {
              iyVal -= 1; // anomaly
            }
            sTmp += `${iTablVal} ${iyVal}\n`;
          }
        
          sTmp += "\nFor curve fitting original Step 9 table\n";
          for (let iXein = 0; iXein < 16; iXein++) { // 0 to 15
            sTmp += `${iXein} ${ArrStp9[iXein]}\n`;
          }
          
          sTmp += "\nTest curve fit for Step 9";
          for (let iXein = 0; iXein < 16; iXein++) { // 0 to 15
            sTmp += `${iXein} ${ArrStp9[iXein]} ${stepByEquatn9(iXein)}\n`;
          }
          sTmp += "\n";  
          const fs = require('fs');
          fs.writeFileSync(sFilnm, sTmp);
          console.log(`Curve Fit Test results are in ${sFilnm}`);
        }
 
        function calculateSum() {
            // NOTE 4: DB DISTANCE REDUCTION (14 column table)
            //below was const
            var hrr = [
              [1, 1.5, 2, 3, 4, 5, 6, 8, 10, 12, 15, 20, 25, 30],
              [-8, -11, -14, -17, -20, -21, -23, -26, -28, -29, -31, -34, -36, -37]
            ];
            
            // NOTE 7: DECIBEL CORRECTION (STEP 9)
            const ArrStp9 = [3.0, 2.5, 2.1, 1.8, 1.5, 1.2, 1.0, 0.8, 0.6, 0.5, 0.4, 0.3, 0.3, 0.2, 0.2, 0.1];
            testCurvFits()
            
            // Test
            const iRws = [0, 3, 6];
            for (const yy of iRws) {
              // range(6) is values 0 to 5.
              for (let xx = 0; xx < 14; xx++) {
                let iTablVal = hrr[1][xx] + yy;
                if (yy > 0 && xx === 5) {
                  iTablVal -= 1; // anomaly
                }
                //process.stdout.write(iTablVal.toString());
                //document.getElementById("result").innerText = "iTablVal: " + iTablVal;
                document.getElementById("result").innerText = "Hello we are here.";
              }
              //console.log();
            }   
            document.getElementById("resulx").innerText = "End of Test.";
            
            // Get the values of the inputs
            document.getElementById("result").innerText = "Get the values of the inputs.";
            var num1 = parseFloat(document.getElementById("num1").value);
            var num2 = parseFloat(document.getElementById("num2").value);

            // Check if both numbers are valid
            if (isNaN(num1) || isNaN(num2)) {
                document.getElementById("result").innerText = "Please enter valid numbers.";
            } else {
                // Calculate the sum
                var sum = num1 + num2;

                // Display the result
                document.getElementById("result").innerText = "Sum: " + sum;
            }
        }
    </script>
</body>
</html>
